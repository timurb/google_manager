#!/usr/bin/env ruby
begin
  require 'gli'
  require 'google'
rescue LoadError
  require 'rubygems'
  require 'bundler/setup'
  require 'gli'
  require 'google_manager'
  require 'active_support/core_ext/hash'
  require 'pp'
end

include GLI::App

program_desc 'Manage google useres and groups'

version GoogleManager::VERSION

#desc 'Describe some switch here'
#switch [:s,:switch]

desc 'A config file to use'
default_value 'google.yml'
arg_name 'config.yml'
flag [:c,:config]

["user", "group", "nickname"].each do |type|
  desc "Manage google #{type.pluralize}"
#  arg_name 'list create delete'
  command type.to_sym do |c|
    c.action do |global_options,options,args|
      command = args.delete_at(0)
      puts GoogleManager::Connector.command(type, command, args)
    end
  end
end

pre do |global,command,options,args|
  config = YAML.load( File.read( global[:config])).symbolize_keys
  GoogleManager::Connector.new(config)
end

on_error do |e|
  raise e
end

exit run(ARGV)
